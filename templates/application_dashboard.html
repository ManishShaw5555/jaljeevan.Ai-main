{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Officer Dashboard - JalJeevan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/officerAuth.css' %}">
    <style>
        :root {
            --primary-dark: #0a1929;
            --primary-medium: #0d2337;
            --primary-light: #143d66;
            --accent-blue: #2196f3;
            --accent-teal: #00e5ff;
            --text-primary: #e6f7ff;
            --text-secondary: #b3e0ff;
            --success-color: #00c853;
            --danger-color: #ff5252;
            --warning-color: #ffab00;
            --glow-color: rgba(33, 150, 243, 0.6);
        }

        body {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-medium) 50%, var(--primary-light) 100%);
            min-height: 100vh;
            font-family: 'Exo 2', sans-serif;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-header {
            background: rgba(13, 35, 55, 0.8);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(33, 150, 243, 0.3);
            backdrop-filter: blur(10px);
        }

        .dashboard-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .dashboard-title i {
            font-size: 40px;
            color: var(--accent-teal);
            text-shadow: 0 0 10px var(--glow-color);
        }

        .dashboard-title h1 {
            margin: 0;
            font-size: 28px;
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
        }

        .dashboard-title p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .officer-info {
            text-align: right;
        }

        .officer-info p {
            margin: 0;
            color: var(--text-secondary);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(13, 35, 55, 0.8);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid rgba(33, 150, 243, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .stat-card.active {
            border: 2px solid var(--accent-teal);
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.4);
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 40px;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
        }

        .stat-icon.pending {
            background: rgba(255, 171, 0, 0.2);
            color: var(--warning-color);
            box-shadow: 0 0 15px rgba(255, 171, 0, 0.3);
        }

        .stat-icon.approved {
            background: rgba(0, 200, 83, 0.2);
            color: var(--success-color);
            box-shadow: 0 0 15px rgba(0, 200, 83, 0.3);
        }

        .stat-icon.rejected {
            background: rgba(255, 82, 82, 0.2);
            color: var(--danger-color);
            box-shadow: 0 0 15px rgba(255, 82, 82, 0.3);
        }

        .stat-content h3 {
            margin: 0;
            font-size: 32px;
            color: var(--text-primary);
        }

        .stat-content p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .applications-table {
            background: rgba(13, 35, 55, 0.8);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(33, 150, 243, 0.3);
            backdrop-filter: blur(10px);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .application-card {
            background: rgba(20, 61, 102, 0.5);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent-blue);
            transition: all 0.3s;
            border: 1px solid rgba(33, 150, 243, 0.2);
        }

        .application-card:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            transform: translateY(-2px);
            border-left: 4px solid var(--accent-teal);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .app-id {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-teal);
            text-shadow: 0 0 5px rgba(0, 229, 255, 0.5);
        }

        .app-status {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .app-status.pending {
            background: var(--warning-color);
            color: var(--primary-dark);
            box-shadow: 0 0 10px rgba(255, 171, 0, 0.5);
        }

        .app-status.approved {
            background: var(--success-color);
            color: white;
            box-shadow: 0 0 10px rgba(0, 200, 83, 0.5);
        }

        .app-status.rejected {
            background: var(--danger-color);
            color: white;
            box-shadow: 0 0 10px rgba(255, 82, 82, 0.5);
        }

        .app-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-item i {
            color: var(--accent-teal);
            width: 20px;
        }

        .detail-item strong {
            color: var(--text-primary);
        }

        .detail-item span {
            color: var(--text-secondary);
        }

        .app-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-view {
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-teal));
            color: var(--primary-dark);
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
        }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.5);
        }

        .btn-approve {
            background: linear-gradient(45deg, var(--success-color), #69f0ae);
            color: var(--primary-dark);
            box-shadow: 0 0 10px rgba(0, 200, 83, 0.3);
        }

        .btn-approve:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 200, 83, 0.5);
        }

        .btn-reject {
            background: linear-gradient(45deg, var(--danger-color), #ff8a80);
            color: white;
            box-shadow: 0 0 10px rgba(255, 82, 82, 0.3);
        }

        .btn-reject:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 82, 82, 0.5);
        }

        .btn-under-review {
            background: linear-gradient(45deg, #00b0ff, #00e5ff);
            color: var(--primary-dark);
            box-shadow: 0 0 10px rgba(0, 176, 255, 0.3);
        }

        .btn-under-review:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 176, 255, 0.5);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
            color: var(--accent-teal);
        }

        .location-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            background: rgba(0, 229, 255, 0.1);
            border-radius: 20px;
            font-size: 12px;
            color: var(--accent-teal);
            font-weight: 600;
            border: 1px solid rgba(0, 229, 255, 0.3);
        }

        .btn-outline-danger {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .btn-outline-danger:hover {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-outline-primary {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .btn-outline-primary:hover {
            background-color: var(--accent-blue);
            color: var(--primary-dark);
        }

        /* Section visibility control */
        .application-section {
            display: none;
        }

        .application-section.active {
            display: block;
        }
    </style>
</head>

<body>
    {% csrf_token %}

    <!-- Officer Registration Modal -->
    <div id="officer-signup-modal" class="auth-modal" role="dialog" aria-labelledby="officer-signup-title" aria-hidden="true">
        <div class="modal-backdrop" onclick="closeModal('officer-signup-modal')"></div>
        <div class="modal-container">
            <div class="modal-card">
                <div class="modal-close">
                    <i class="fas fa-times" aria-hidden="true" onclick="closeModal('officer-signup-modal')"></i>
                </div>

                <div class="modal-header">
                    <h2 id="officer-signup-title">Officer Registration</h2>
                    <p>Register as a government officer to manage applications</p>
                </div>

                <form class="auth-form" id="officer-signup-form" method="POST" action="{% url 'officer:register' %}" novalidate>
                    {% csrf_token %}

                    <div class="form-group">
                        <label for="officer-name" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="text" name="officer_name" id="officer-name" class="form-control" placeholder="Enter full name" required autocomplete="name" maxlength="50">
                            <i class="fas fa-user-tie input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="govt-id" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="text" name="govt_id" id="govt-id" class="form-control" placeholder="Enter government ID (10 characters)" required autocomplete="off" maxlength="10">
                            <i class="fas fa-id-card input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="officer-email" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="email" name="officer_email" id="officer-email" class="form-control" placeholder="Enter official email" required autocomplete="email">
                            <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="officer-phone" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="tel" name="officer_phone" id="officer-phone" class="form-control" placeholder="Enter 10-digit phone number" required autocomplete="tel" pattern="[0-9]{10}" maxlength="10">
                            <i class="fas fa-phone input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="assigned-district" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="text" name="assigned_district" id="assigned-district" class="form-control" placeholder="Enter assigned district" required autocomplete="off" maxlength="100">
                            <i class="fas fa-map-marker-alt input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="officer-password" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="password" name="password" id="officer-password" class="form-control" placeholder="Create password" required autocomplete="new-password">
                            <i class="fas fa-lock input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="officer-confirm-password" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="password" name="confirm_password" id="officer-confirm-password" class="form-control" placeholder="Confirm password" required autocomplete="new-password">
                            <i class="fas fa-lock input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <button type="submit" class="btn-auth">
                        <span>Register Officer</span>
                        <i class="fas fa-user-check" aria-hidden="true"></i>
                    </button>
                </form>

                <div class="auth-switch">
                    Already registered?
                    <a href="#" onclick="switchAuthModal('officer-login-modal')" class="auth-link">Officer Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Officer Login Modal -->
    <div id="officer-login-modal" class="auth-modal" role="dialog" aria-labelledby="officer-login-title" aria-hidden="true">
        <div class="modal-backdrop" onclick="closeModal('officer-login-modal')"></div>
        <div class="modal-container">
            <div class="modal-card">
                <div class="modal-close">
                    <i class="fas fa-times" aria-hidden="true" onclick="closeModal('officer-login-modal')"></i>
                </div>

                <div class="modal-header">
                    <h2 id="officer-login-title">Officer Login</h2>
                    <p>Access the application management dashboard</p>
                </div>

                <form class="auth-form" id="officer-login-form" method="POST" action="{% url 'officer:login' %}" novalidate>
                    {% csrf_token %}

                    <div class="form-group">
                        <label for="officer-login-name" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="text" name="officer_name" id="officer-login-name" class="form-control" placeholder="Enter your name" required autocomplete="name">
                            <i class="fas fa-user-tie input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="officer-login-govt-id" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="text" name="govt_id" id="officer-login-govt-id" class="form-control" placeholder="Enter government ID" required autocomplete="off">
                            <i class="fas fa-id-card input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="officer-login-password" class="form-label"></label>
                        <div class="input-wrapper">
                            <input type="password" name="password" id="officer-login-password" class="form-control" placeholder="Enter password" required autocomplete="current-password">
                            <i class="fas fa-lock input-icon" aria-hidden="true"></i>
                        </div>
                    </div>

                    <div class="form-options">
                        <label class="remember-me">
                            <input type="checkbox" name="remember_me">
                            <span class="checkmark"></span>
                            Remember me
                        </label>
                        <a href="#" class="forgot-password">Forgot Password?</a>
                    </div>

                    <button type="submit" class="btn-auth">
                        <span>Sign In</span>
                        <i class="fas fa-arrow-right" aria-hidden="true"></i>
                    </button>
                </form>

                <div class="auth-switch">
                    Not registered yet?
                    <a href="#" onclick="switchAuthModal('officer-signup-modal')" class="auth-link">Register as Officer</a>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <i class="fas fa-tachometer-alt"></i>
                <div>
                    <h1>Officer Dashboard</h1>
                    <p>Manage Rainwater Harvesting Subsidy Applications</p>
                </div>
            </div>
            {% if request.session.is_officer %}
            <div class="officer-info">
                <p><small>District Officer - {{ request.session.officer_name }}</small></p>
                <p><strong>{{ request.session.officer_email }}</strong></p>
                <p><small>District - {{ officer_district }}</small></p>
                <button onclick="handleLogout(event)" class="btn btn-sm btn-outline-danger mt-2" type="button">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            {% else %}
            <div class="officer-info">
                <p><strong>Guest</strong></p>
                <p><small>Please login to continue</small></p>
                <button onclick="openModal('officer-login-modal')" class="btn btn-sm btn-outline-primary mt-2" type="button">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
            {% endif %}
        </div>

        <!-- Stats Cards -->
        <div class="stats-cards">
            <div class="stat-card active" data-filter="pending" onclick="filterApplications('pending')">
                <div class="stat-icon pending">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ pending_count|default:0 }}</h3>
                    <p>Pending Applications</p>
                </div>
            </div>

            <div class="stat-card" data-filter="approved" onclick="filterApplications('approved')">
                <div class="stat-icon approved">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ approved_count|default:0 }}</h3>
                    <p>Approved This Month</p>
                </div>
            </div>

            <div class="stat-card" data-filter="rejected" onclick="filterApplications('rejected')">
                <div class="stat-icon rejected">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ rejected_count|default:0 }}</h3>
                    <p>Rejected This Month</p>
                </div>
            </div>
        </div>

        <!-- PENDING APPLICATIONS SECTION -->
        <div class="applications-table application-section active" id="pending-section">
            <div class="table-header">
                <h3><i class="fas fa-clock"></i> Pending Applications</h3>
            </div>

            {% if pending_data %}
                {% for app in pending_data %}
                <div class="application-card">
                    <div class="app-header">
                        <div>
                            <div class="app-id">
                                <i class="fas fa-file-alt"></i> {{ app.application_id }}
                            </div>
                            <div class="mt-2">
                                {% if app.geo_latitude and app.geo_longitude %}
                                <span class="location-badge">
                                    <i class="fas fa-map-marker-alt"></i>
                                    GPS Verified (±{{ app.gps_accuracy_meters|floatformat:0 }}m)
                                </span>
                                {% else %}
                                <span class="location-badge">
                                    <i class="fas fa-map-marker"></i>
                                    Manual Location
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <span class="app-status pending">
                            <i class="fas fa-paper-plane"></i> {{ app.status }}
                        </span>
                    </div>

                    <div class="app-details">
                        <div class="detail-item">
                            <i class="fas fa-user"></i>
                            <div><strong>{{ app.full_name }}</strong></div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-envelope"></i>
                            <span>{{ app.email }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-phone"></i>
                            <span>{{ app.mobile }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-id-card"></i>
                            <span>{{ app.aadhar_or_id }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ app.district }}, {{ app.pincode }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="far fa-clock"></i>
                            <span>{{ app.created_at }}</span>
                        </div>
                    </div>

                    <div class="detail-item" style="margin-bottom: 15px;">
                        <i class="fas fa-home"></i>
                        <span>{{ app.property_address }}</span>
                    </div>

                    <div class="app-actions">
                        <button class="btn-action btn-view" onclick="viewApplication('{{ app.application_id }}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>

                        {% if app.calculation_pdf_url %}
                        <a href="{{ app.calculation_pdf_url }}" target="_blank" class="btn-action btn-view">
                            <i class="fas fa-file-pdf"></i> View PDF
                        </a>
                        {% endif %}

                        {% if app.status != 'UNDER_REVIEW' %}
                        <button class="btn-action btn-under-review" onclick="underReviewApplication('{{ app.application_id }}')">
                            <i class="fas fa-eye"></i> Under Review
                        </button>
                        {% endif %}

                        <button class="btn-action btn-approve" onclick="approveApplication('{{ app.application_id }}')">
                            <i class="fas fa-check"></i> Approve
                        </button>

                        <button class="btn-action btn-reject" onclick="rejectApplication('{{ app.application_id }}')">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>

                    <!-- Hidden details for modal -->
                    <div id="applicationDetails_{{ app.application_id }}" style="display: none;">
                        <h4 style="color: #667eea; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
                            <i class="fas fa-info-circle"></i> Full Application Details
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <p><strong><i class="fas fa-user"></i> Applicant Name:</strong><br>{{ app.full_name }}</p>
                            </div>
                            <div>
                                <p><strong><i class="fas fa-envelope"></i> Email:</strong><br>{{ app.email }}</p>
                            </div>
                            <div>
                                <p><strong><i class="fas fa-phone"></i> Mobile Number:</strong><br>{{ app.mobile }}</p>
                            </div>
                            <div>
                                <p><strong><i class="fas fa-id-card"></i> Aadhar/ID:</strong><br>{{ app.aadhar_or_id }}</p>
                            </div>
                            <div>
                                <p><strong><i class="fas fa-map-marker-alt"></i> District:</strong><br>{{ app.district }}</p>
                            </div>
                            <div>
                                <p><strong><i class="fas fa-map-pin"></i> Pincode:</strong><br>{{ app.pincode }}</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <p><strong><i class="fas fa-home"></i> Property Address:</strong><br>{{ app.property_address }}</p>
                        </div>

                        {% if app.calculation_pdf_url %}
                        <div style="margin-top: 15px;">
                            <a href="{{ app.calculation_pdf_url }}" target="_blank" class="btn-action btn-view" style="display: inline-flex;">
                                <i class="fas fa-file-pdf"></i> View Calculation PDF
                            </a>
                        </div>
                        {% endif %}
                        
                        {% if app.geo_latitude and app.geo_longitude %}
                        <div style="margin-top: 15px; background: #e8f5e9; padding: 10px; border-radius: 5px;">
                            <p><strong><i class="fas fa-map-marked-alt"></i> GPS Coordinates:</strong><br>
                            Latitude: {{ app.geo_latitude }}, Longitude: {{ app.geo_longitude }}</p>
                            <p><strong><i class="fas fa-crosshairs"></i> GPS Accuracy:</strong> ±{{ app.gps_accuracy_meters|floatformat:0 }} meters</p>
                        </div>
                        {% endif %}
                        
                        <div style="margin-top: 15px;">
                            <p><strong><i class="far fa-clock"></i> Submitted At:</strong><br>{{ app.created_at }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <h4>No Pending Applications</h4>
                <p>There are no pending applications for your district at this time.</p>
            </div>
            {% endif %}
        </div>

        <!-- APPROVED APPLICATIONS SECTION -->
        <div class="applications-table application-section" id="approved-section">
            <div class="table-header">
                <h3><i class="fas fa-check-circle"></i> Approved Applications</h3>
            </div>

            {% if approved_data %}
                {% for app in approved_data %}
                <div class="application-card">
                    <div class="app-header">
                        <div>
                            <div class="app-id">
                                <i class="fas fa-file-alt"></i> {{ app.application_id }}
                            </div>
                            <div class="mt-2">
                                {% if app.geo_latitude and app.geo_longitude %}
                                <span class="location-badge">
                                    <i class="fas fa-map-marker-alt"></i>
                                    GPS Verified (±{{ app.gps_accuracy_meters|floatformat:0 }}m)
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <span class="app-status approved">
                            <i class="fas fa-check-circle"></i> APPROVED
                        </span>
                    </div>

                    <div class="app-details">
                        <div class="detail-item">
                            <i class="fas fa-user"></i>
                            <div><strong>{{ app.full_name }}</strong></div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-envelope"></i>
                            <span>{{ app.email }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-phone"></i>
                            <span>{{ app.mobile }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ app.district }}, {{ app.pincode }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="far fa-clock"></i>
                            <span>{{ app.created_at }}</span>
                        </div>
                    </div>

                    <div class="detail-item" style="margin-bottom: 15px;">
                        <i class="fas fa-home"></i>
                        <span>{{ app.property_address }}</span>
                    </div>

                    <div class="app-actions">
                        <button class="btn-action btn-view" onclick="viewApplication('{{ app.application_id }}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>

                        {% if app.calculation_pdf_url %}
                        <a href="{{ app.calculation_pdf_url }}" target="_blank" class="btn-action btn-view">
                            <i class="fas fa-file-pdf"></i> View PDF
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="empty-state">
                <i class="fas fa-check-circle"></i>
                <h4>No Approved Applications</h4>
                <p>There are no approved applications for your district this month.</p>
            </div>
            {% endif %}
        </div>

        <!-- REJECTED APPLICATIONS SECTION -->
        <div class="applications-table application-section" id="rejected-section">
            <div class="table-header">
                <h3><i class="fas fa-times-circle"></i> Rejected Applications</h3>
            </div>

            {% if rejected_data %}
                {% for app in rejected_data %}
                <div class="application-card">
                    <div class="app-header">
                        <div>
                            <div class="app-id">
                                <i class="fas fa-file-alt"></i> {{ app.application_id }}
                            </div>
                        </div>
                        <span class="app-status rejected">
                            <i class="fas fa-times-circle"></i> REJECTED
                        </span>
                    </div>

                    <div class="app-details">
                        <div class="detail-item">
                            <i class="fas fa-user"></i>
                            <div><strong>{{ app.full_name }}</strong></div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-envelope"></i>
                            <span>{{ app.email }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-phone"></i>
                            <span>{{ app.mobile }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ app.district }}, {{ app.pincode }}</span>
                        </div>
                        <div class="detail-item">
                            <i class="far fa-clock"></i>
                            <span>{{ app.created_at }}</span>
                        </div>
                    </div>

                    <div class="detail-item" style="margin-bottom: 15px;">
                        <i class="fas fa-home"></i>
                        <span>{{ app.property_address }}</span>
                    </div>

                    {% if app.rejection_reason %}
                    <div class="detail-item" style="margin-bottom: 15px; color: var(--danger-color);">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span><strong>Reason:</strong> {{ app.rejection_reason }}</span>
                    </div>
                    {% endif %}

                    <div class="app-actions">
                        <button class="btn-action btn-view" onclick="viewApplication('{{ app.application_id }}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>

                        {% if app.calculation_pdf_url %}
                        <a href="{{ app.calculation_pdf_url }}" target="_blank" class="btn-action btn-view">
                            <i class="fas fa-file-pdf"></i> View PDF
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <div class="empty-state">
                <i class="fas fa-times-circle"></i>
                <h4>No Rejected Applications</h4>
                <p>There are no rejected applications for your district this month.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Load officerAuth.js -->
    <script src="{% static 'js/officerAuth.js' %}"></script>

    <!-- Auto-open login modal if not logged in -->
    <script>
        (function() {
            var isOfficerLoggedIn = "{{ request.session.is_officer|yesno:'true,false' }}";
            
            if (isOfficerLoggedIn !== 'true') {
                setTimeout(function() {
                    if (typeof openModal === 'function') {
                        openModal('officer-login-modal');
                    }
                }, 800);
            }
        })();
    </script>

    <!-- Handle logout -->
    <script>
        function handleLogout(event) {
            event.preventDefault();
            
            if (!confirm('Are you sure you want to logout?')) {
                return;
            }
            
            fetch('{% url "officer:logout" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Requested-With': 'XMLHttpRequest',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = data.redirect_url || '/';
                } else {
                    alert('Logout failed: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Logout error:', error);
                window.location.href = '/';
            });
        }
    </script>

    <!-- Application Filtering Script -->
    <script>
        function filterApplications(filterType) {
            // Remove active class from all stat cards
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Add active class to clicked stat card
            const activeCard = document.querySelector('.stat-card[data-filter="' + filterType + '"]');
            if (activeCard) {
                activeCard.classList.add('active');
            }
            
            // Hide all sections
            document.querySelectorAll('.application-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(filterType + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
        }
    </script>

    <!-- Modal control functions -->
    <script>
        window.addEventListener('load', function() {
            window.closeModal = function(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                    modal.setAttribute('aria-hidden', 'true');
                    document.body.style.overflow = 'auto';
                    
                    const allBackdrops = document.querySelectorAll('.modal-backdrop');
                    allBackdrops.forEach(function(backdrop) {
                        backdrop.style.pointerEvents = 'none';
                        backdrop.style.display = 'none';
                    });
                    
                    const form = modal.querySelector('.auth-form');
                    if (form) form.reset();
                    
                    const messageContainer = modal.querySelector('.message-container');
                    if (messageContainer) messageContainer.remove();
                }
            };
            
            window.openModal = function(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                    modal.setAttribute('aria-hidden', 'false');
                    document.body.style.overflow = 'hidden';
                    
                    const backdrop = modal.querySelector('.modal-backdrop');
                    if (backdrop) {
                        backdrop.style.pointerEvents = 'auto';
                        backdrop.style.display = 'block';
                    }
                }
            };
        });
    </script>
</body>
</html>
